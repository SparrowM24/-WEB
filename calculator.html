<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="Img/Logo.png" type="image/x-icon">
        <title>Калькулятор валют | Башнефть</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
        <style>
            /* Общие настройки */
            body {
               20px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: #f5f5f5;
                color: #333;
                line-height: 1.6;
                margin: 0;
            }
            
            /* Основной контент */
            main {
                max-width: 900px;
                margin: 0 auto;
                padding: 20px;
                background-color: white;
                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            }
            
            .menu-icon {
                position: fixed;
                top: 1rem;
                right: 1rem;
                width: 32px;
                height: 28px;
                cursor: pointer;
                z-index: 1001;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            .menu-icon span {
                display: block;
                height: 4px;
                background-color: #333;
                border-radius: 2px;
                transition: background-color 0.3s ease;
            }

            .menu-panel {
                position: fixed;
                top: 50px;
                right: 1rem;
                background: #fff;
                box-shadow: 0 2px 10px rgb(0 0 0 / 0.15);
                border-radius: 8px;
                padding: 0.5rem 0;
                min-width: 160px;
                display: none;
                flex-direction: column;
                z-index: 1000;
            }

            .menu-panel.show {
                display: flex;
            }

            .menu-panel a {
                padding: 0.75rem 1.25rem;
                text-decoration: none;
                color: #333;
                font-weight: 500;
                transition: background-color 0.3s ease, color 0.3s ease;
            }

            .menu-panel a:hover {
                background-color: #008B0F;
                color: white;
            }

            .menu-panel a.active {
                background-color: #005a09;
                color: #fff;
                font-weight: 700;
            }
            
            /* Таблица конвертации валюты */
            table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }
            th, td {
                padding: 8px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }
            tr:nth-child(even){background-color: #f2f2f2}
            
            /* Диаграмма */
            canvas {
                display: block;
                margin: 0 auto;
            }
        </style>
    
        <script>
            function CBR_XML_Daily_Ru(rates) {
                function trend(current, previous) {
                    if (current > previous) return ' ▲';
                    if (current < previous) return ' ▼';
                    return '';
                }                
                var KRWrate = rates.Valute.KRW.Value.toFixed(4).replace('.', ',');
                var KRW = document.getElementById('KRW');
                KRW.innerHTML = KRW.innerHTML.replace('00,0000', KRWrate);
                KRW.innerHTML += trend(rates.Valute.KRW.Value, rates.Valute.KRW.Previous);
            }
            
            async function fetchRates() {
                const response = await fetch('https://www.cbr-xml-daily.ru/daily_json.js');
                const data = await response.json();
                CBR_XML_Daily_Ru(data);
                fetchHistoricalRates();
            }

            function convertToKRW() {
                var rubles = parseFloat(document.getElementById('rubles').value);
                var krwRate = parseFloat(document.getElementById('KRW').innerHTML.split('—')[1].replace(',', '.').trim());
                var result = rubles * krwRate;
                document.getElementById('resultKRW').innerHTML = result.toFixed(0) + ' ₩';
            }
            function convertToRUB() {
                var won = parseFloat(document.getElementById('won').value);
                var krwRate = parseFloat(document.getElementById('KRW').innerHTML.split('—')[1].replace(',', '.').trim());
                var result = won / krwRate;
                document.getElementById('resultRUB').innerHTML = result.toFixed(2) + ' ₽';
            }

            let krwRates = [];
            let krwDates = [];

            async function fetchHistoricalRates() {
                const today = new Date();
                const lastMonth = new Date();
                lastMonth.setMonth(today.getMonth() - 1);
                const promises = [];

                for (let d = lastMonth; d <= today; d.setDate(d.getDate() + 1)) {
                    const year = d.getFullYear();
                    const month = String(d.getMonth() + 1).padStart(2, '0');
                    const day = String(d.getDate()).padStart(2, '0');
                    const date = `/${year}/${month}/${day}`;
                    promises.push(fetchHistoricalRate(date));
                }

                await Promise.all(promises);
                drawChart();
            }

            async function fetchHistoricalRate(date) {
                try {
                    const response = await fetch(`https://www.cbr-xml-daily.ru/archive${date}/daily_json.js`);
                    if (!response.ok) {
                        throw new Error('Ошибка при получении данных за ' + date);
                    }
                    const data = await response.json();
                    if (data.Valute.KRW) {
                        krwRates.push(data.Valute.KRW.Value);
                        krwDates.push(date);
                    }
                } catch (error) {
                    console.error('Ошибка при получении исторических данных:', error);
                }
            }

            function drawChart() {
                const ctx = document.getElementById('krwChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: krwDates,
                        datasets: [
                            {
                                label: 'Курс KRW',
                                data: krwRates,
                                backgroundColor: 'rgba(0, 139, 15, 0.6)',
                                borderColor: 'rgba(0, 139, 15, 0.6)',
                                borderWidth: '3px'
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Курс (в рублях)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Дата'
                                }
                            }
                        }
                    }
                });
            }

            window.onload = fetchRates; // Загружаем данные при загрузке страницы
        </script>
    </head>
    <body>
        <main>
            <div class="menu-icon" id="menuIcon" aria-label="Меню" role="button" tabindex="0" aria-expanded="false" aria-controls="menuPanel">
            <span></span><span></span><span></span>
            </div>

            <nav class="menu-panel" id="menuPanel" role="menu" aria-labelledby="menuIcon">
                <a href="about.html" role="menuitem" tabindex="-1">О нас</a>
                <a href="News.html" role="menuitem" tabindex="-1">Новости</a>
                <a href="calculator.html" class="active" role="menuitem" tabindex="-1">Калькулятор</a>
                <a href="contacts.html" role="menuitem" tabindex="-1">Контакты</a>
            </nav>

            <script>
                var icon = document.querySelector('#menuIcon');
                var panel = document.querySelector('#menuPanel');

                icon.addEventListener('click', function() {
                panel.classList.toggle('show');
                icon.setAttribute('aria-expanded', panel.classList.contains('show'));
                });

                document.body.addEventListener('click', function(event) {
                if (!event.target.closest('.menu-icon,.menu-panel')) {
                    panel.classList.remove('show');
                    icon.setAttribute('aria-expanded', false);
                }
                });
            </script>
            <section>
                <div id="KRW">Вон Республики Корея (KRW) — 00,0000 руб.</div>
                <h2>Конвертация валют</h2>
                <table>
                    <tr>
                        <th>Направление конвертации</th>
                        <th>Сумма</th>
                        <th>Результат</th>
                    </tr>
                    <tr>
                        <td>Рубли → Воны</td>
                        <td><input type="number" id="rubles" placeholder="Введите сумму в рублях"/></td>
                        <td><button onclick="convertToKRW()">Конвертировать</button></td>
                        <td><div id="resultKRW"></div></td>
                    </tr>
                    <tr>
                        <td>Воны → Рубли</td>
                        <td><input type="number" id="won" placeholder="Введите сумму в вонах"/></td>
                        <td><button onclick="convertToRUB()">Конвертировать</button></td>
                        <td><div id="resultRUB"></div></td>
                    </tr>
                </table>
            </section>
            <section>
                <h2>Динамика курса KRW за последний месяц</h2>
                <canvas id="krwChart" width="600" height="300"></canvas>
            </section>
        </main>
    </body>
</html>