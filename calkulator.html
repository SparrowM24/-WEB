<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор валют</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div>
        <h2>Калькулятор валют</h2>
        <input type="number" id="amount" placeholder="Сумма" />
        <select id="fromCurrency">
            <option value="RUB">Рубли</option>
            <option value="KRW">Вон Республики Кореи</option>
        </select>
        <select id="toCurrency">
            <option value="RUB">Рубли</option>
            <option value="KRW">Вон Республики Кореи</option>
        </select>
        <button onclick="convertCurrency()">Конвертировать</button>
        <div id="result"></div>
    </div>

    <h2>График изменений курса KRW</h2>
    <canvas id="currencyChart" width="400" height="200"></canvas>

    <script>
        let krwRate;

        // Получение актуального курса и данных для графика
        async function fetchCurrencyData() {
            try {
                const response = await fetch('https://www.cbr-xml-daily.ru/daily_json.js');
                const data = await response.json();
                krwRate = data.Valute.KRW.Value;
                console.log('Актуальный курс KRW:', krwRate);
                fetchCurrencyHistory();
            } catch (error) {
                console.error('Ошибка:', error);
            }
        }

        // Конвертация валют
        function convertCurrency() {
            const amount = document.getElementById('amount').value;
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;

            if (fromCurrency === 'RUB' && toCurrency === 'KRW') {
                const result = (amount * krwRate).toFixed(2);
                document.getElementById('result').innerText = `Результат: ${result} KRW`;
            } else if (fromCurrency === 'KRW' && toCurrency === 'RUB') {
                const result = (amount / krwRate).toFixed(2);
                document.getElementById('result').innerText = `Результат: ${result} RUB`;
            } else {
                document.getElementById('result').innerText = 'Выберите разные валюты для конвертации.';
            }
        }

        // Получение исторических данных для графика
        async function fetchCurrencyHistory() {
            const today = new Date();
            const endDate = today.toISOString().split('T')[0];
            today.setMonth(today.getMonth() - 1);
            const startDate = today.toISOString().split('T')[0];

            const url = `https://www.cbr-xml-daily.ru/archive/2023/10/01/daily_json.js`; // Замените на актуальный URL для получения исторических данных

            try {
                const response = await fetch(url);
                const data = await response.json();
                const rates = data.Valute.KRW; // Здесь нужно будет обработать данные для получения курса по дням
                drawChart(rates);
            } catch (error) {
                console.error('Ошибка:', error);
            }
        }

        // Построение графика
        function drawChart(data) {
            const ctx = document.getElementById('currencyChart').getContext('2d');
            const labels = data.map(item => item.Date); // Даты
            const rates = data.map(item => item.Value); // Курсы

            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Курс KRW',
                        data: rates,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Инициализация
        fetchCurrencyData();
    </script>
</body>
</html>
